<div data-controller="live-css-editor"
  data-action="submit->live-css-editor#prepare"
  data-live-css-editor-filename-value="<%= @theme_file.filename || 'theme.css' %>"
  style="height: calc(100vh - 180px);"
>

  <% form_params = {
    model: @theme_file,
    url: theme_maker_path(@theme_file),
    method: :put,
    local: true,
    html: { multipart: true }
  } %>

  <%= form_with(**form_params) do |form| %>

    <%= form.hidden_field(
      :description,
      value: @theme_file.description,
    ) %>

    <div class="flex flex-row space-between gap-4">
      <div class="w-[30%] h-full flex flex-col gap-1">
        <%= form.file_field :file,
          label: false,
          data: { live_css_editor_target: "fileInput" },
          style: "display:none"
        %>

        <%= form.text_area :body,
          label: false,
          rows: 30,
          data: {
            action: "input->live-css-editor#send",
            live_css_editor_target: "textarea"
          },
          class: "w-full h-full",
          value: @theme_file.file.open { |io| io.read.force_encoding("UTF-8") }
        %>
      </div>

      <div class="flex border-1 w-[70%]">
        <!-- Load the normal landing page inside the iframe -->
        <iframe id="landing-preview"
          src="/?live_preview=1"
          class="w-full h-full border-0"
          data-live-css-editor-target="iframe">
          >
        </iframe>
      </div>
    </div>

    <div style="margin-top:8px;">
      <%= form.submit "Save", class: "mt-2 px-3 py-1 border rounded" %>
    </div>
  <% end %>
</div>

<%= append_javascript_pack_tag "decidim_admin_theme_maker" %>
